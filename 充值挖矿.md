- 根据每个用户通过充值挖矿折合产生的`虚拟投票`与参与节点选举产生的`真实投票`之和来衡量用户的“算力”。

用户充值进入链外资产，然后根据兑PCX市值的一半或恒定比例，折合成 PCX 虚拟投票。用户的跨链资产可以处于可用余额、交易冻结、提现冻结状态，也就是说用户挂单中和提现中的资产仍然能够参与充值挖矿。

### 折合投票

用户无论是充值 BTC，还是映射 SDOT，都**不会直接产生 PCX**, 系统会自动根据如下规则将 BTC 和 SDOT 换算成等量的 PCX，参与每个分红周期的分红奖励。每个分红周期的奖励金额见

#### BTC

#### SDOT

* 根据币币交易系统中产生的 PCX/BTC 的每小时移动平均价 price，得出 BTC 兑 PCX 的平均价 P = 1 / price。

* BTC 的折合投票算法为 1：P * 50%，之所以打五折，是为了增强用户使用 PCX 进行选举投票的重要性。

* SDOT 的折合投票算法为 1：0.1，是恒定的持续挖矿算力，只是对于早期 DOT 投资者的一点福利。

```
比如交易所 PCX/BTC 的移动均价为 0.00001
某个用户持有 1 个 BTC， 2000 个 SDOT，同时用户投票了 300 PCX 给某些节点
则用户的总挖矿算力为 1 * (1 / 0.00001) * 50% + 2000 * 0.1 + 300 = 5500 PCX。
```

### 充值奖励

#### BTC

BTC 用户进行跨链充值时，需要等待 BTC 交易确认(等待 6 个 BTC 块)后，ChainX 才会在链内给相应的充值地址发放 X-BTC。对于每次 BTC 充值，我们会根据用户的 BTC 充值金额，计算等待确认时间所累积的充值币龄，从 BTC 奖池中给用户发放相应的充值奖励，具体计算方式如下：

```
充值奖励 = (充值金额 * BTC确认时间) / BTC 总币龄 * BTC 奖池金额
```

#### SDOT

DOT 用户进行映射并没有充值奖励，但是会参与后续的充值挖矿。

### 充值挖矿利息

BTC和SDOT相当于两个虚拟节点，通过自身的总发行量来折合各自的“总得票数”，与下面的真实投票节点的总得票数，一起衡量比例关系，平分每个周期发行的PCX。每个周期的奖励打入一个无人知道私钥的特殊账户，作为该虚拟节点的奖池，奖池账户计算逻辑为hash（币种名称）。用户在虚拟节点的待领利息不是自动分配，而是需要用户手工提息时再计算。

#### 充值利息计算公式

币龄计算公式与投票选举的票龄逻辑相同。

每个虚拟节点 有如下属性：总币龄、总币龄更新高度，在各资产的发行量有变化是更新，比如充值和提现确认时：

```
总币龄 = 老总币龄 + 老发行量 *（当前高度 - 老总币龄更新高度）

总币龄更新高度 = 当前高度
```

用户在虚拟节点都有如下属性：用户币龄、用户币龄更新高度，在各用户持有该种资产的量有变化时更新，比如转账、币币交易成交、提现确认时：

```
用户币龄 = 老用户币龄 + 老用户持有量 *（当前高度 - 老用户币龄更新高度）

用户币龄更新高度 = 当前高度
```

则如果用户持有某种资产，可以先获取虚拟节点和用户的币龄信息，然后根据当前高度，实时在前端计算待领利息，计算逻辑为：

```
最新总币龄 = 总币龄 + 发行量 *（当前高度 - 总币龄更新高度）

最新用户币龄 = 用户币龄 + 持有量 *（当前高度 - 用户币龄更新高度）

总待领利息 = （最新用户币龄 / 最新总币龄） * 奖池金额
```

#### 充值利息分配

首先根据上面的充值利息计算公式得出用户充值总利息，用户实际获得利息分配如下：

```
用户待领利息 = 总待领利息 * 90%

渠道或议会待领利息 = 总待领利息 * 10%。
```

当用户进行跨链充值时，有一个可选的充值渠道，该充值渠道为 ChainX 内某一节点。

- 为了奖励充值渠道，当用户进行提息操作时，首先会查询用户充值渠道，如果存在，则将总待领利息的 10% 打给渠道，如果不存在则打给议会账户，作为社区发展基金。
- 扣除奖励渠道方的 10%，剩余总待领利息的 90% 才是充值用户实际可得的利息。

### 交易接口：提取利息

* 参数：资产ID
* 判断：只有持有该资产的用户才可以调用。

根据上述的待领利息计算方法，计算用户利息和渠道或议会利息，从奖池账户中扣除，并分别增加给他们的可用余额。
