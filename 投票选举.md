### 启动配置

* 验证节点数：最少 4 个，最多 100 个
* 信托节点数：最少 4 个，最多 15 个
* 分红周期：150 个块，约 5 分钟
* 验证节点选举周期
    - 测试网：2 个分红周期，300 个块，约 10 分钟
    - 正式网：12 个分红周期，1800 个块，约 60 分钟
* 用户投票赎回冻结期：72 个选举周期，测试网约 0.5 天，主网约 3 天
* 节点抵押赎回锁定期：720 个选举周期，测试网约 5 天，主网约 30 天

### 基本概念

#### 投票利息

节点每个周期的奖励打入一个无人知道私钥的特殊账户，作为该节点的奖池，奖池账户计算逻辑为hash（节点账户ID）。用户在节点的待领利息不是自动分配，而是需要用户手工提息时再计算。

每个真实节点 有如下属性：总票龄、总票龄更新高度，在节点的总得票数有变化时更新，比如投票和赎回时：

```
总票龄 = 老总票龄 + 老总投票金额 *（当前高度 - 老总票龄更新高度）
总票龄更新高度 = 当前高度
```

用户在节点都有如下属性：用户票龄、用户票龄更新高度，在各用户对该节点的投票变化时更新，比如投票和赎回时：

```
用户票龄 = 老用户票龄 + 老用户投票量 *（当前高度 - 老用户票龄更新高度）
用户票龄更新高度 = 当前高度
```

则如果用户对某节点投了票，可以先获取节点和用户的票龄信息，然后根据当前高度，实时在前端计算待领利息，计算逻辑为：

```
最新总票龄 = 总票龄 + 总投票金额 *（当前高度 - 总票龄更新高度）
最新用户票龄 = 用户票龄 + 投票金额 *（当前高度 - 用户票龄更新高度）
用户待领利息 = （最新用户票龄 / 最新总票龄） * 奖池金额
```

### 交易接口：注册节点

* 参数：节点名
* 判断：任何人都可以提交，节点名小于16字节，并且不能重复

初始化该节点的票龄信息，并将初始状态设置为‘退选’

### 交易接口：更新节点

* 参数：网址、简介、出块账户ID、状态（参选|退选）
* 判断：只有已注册节点可以调用，网址字节范围是4到24，只能数字、大小写字母和. ，简介小于128字节。

如果参选节点数小于 最小验证节点数 则不能退选，其余情况下直接更新节点信息。

### 交易接口：设置信托

* 参数：链ID、简介、热公钥、冷公钥
* 判断：只有参选节点可以调用，链目前只能是Bitcoin，并且公钥格式正确。

更新节点的信托设置，只有正确设置了所有链的信托，才可能被选举为信托节点。

### 交易接口：增加投票

* 参数：节点账户ID、增加金额、备注
* 判断：任何人都可以调用，节点账户必须存在，增加金额需小于用户的 PCX 可用余额，备注小于64字节

如果正确，则增加用户的投票，并更新用户和节点的票龄信息。

### 交易接口：赎回投票

* 参数：节点账户ID、赎回金额、备注
* 判断：只有投票了该节点的用户才能调用，赎回金额需小于等于原投票金额，备注小于64字节

如果正确，则扣减用户的投票，并新增赎回记录，计算赎回解冻高度（需判断是赎回节点自抵押，还是普通用户投票），并更新用户和节点的票龄信息。用户赎回节点的投票后，赎回锁定中的资金不会在产生收益。

### 交易接口：赎回解冻

* 参数：节点账户ID、索引
* 判断：只有用户存在该索引对应的赎回操作才可以调用，而且当前高度必须大于解锁高度。

如果正确，则将赎回金额转变为用户的可用余额，并删除赎回记录。

### 交易接口：提取利息

* 参数：资产ID
* 判断：只有持有该资产的用户才可以调用。

根据上述的待领利息计算方法，计算用户利息，从奖池账户中扣除，并增加给用户的可用余额。
